CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,

    email VARCHAR(255) UNIQUE,
    password VARCHAR(255),          -- 소셜 로그인은 NULL 가능
    name VARCHAR(100),

    provider VARCHAR(20),            -- LOCAL, GOOGLE, KAKAO, NAVER
    provider_id VARCHAR(255),        -- 소셜 고유 ID

    role VARCHAR(20) DEFAULT 'USER', -- USER, ADMIN
    status VARCHAR(20) DEFAULT 'ACTIVE', -- ACTIVE, BLOCKED

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);
CREATE TABLE refresh_tokens (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    token VARCHAR(500) NOT NULL,
    expired_at DATETIME NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_refresh_user
        FOREIGN KEY (user_id) REFERENCES users(id)
        ON DELETE CASCADE
);
CREATE TABLE items (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    seller_id BIGINT NOT NULL,

    title VARCHAR(255) NOT NULL,
    description TEXT,
    category VARCHAR(100),

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_item_seller
        FOREIGN KEY (seller_id) REFERENCES users(id)
);
CREATE TABLE auctions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    item_id BIGINT NOT NULL,

    start_price BIGINT NOT NULL,
    current_price BIGINT NOT NULL,
    min_bid_unit BIGINT DEFAULT 1000,

    start_at DATETIME NOT NULL,
    end_at DATETIME NOT NULL,

    status VARCHAR(20) DEFAULT 'READY', 
    -- READY, RUNNING, ENDED, CANCELED

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    CONSTRAINT fk_auction_item
        FOREIGN KEY (item_id) REFERENCES items(id)
);
CREATE TABLE bids (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    auction_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,

    bid_price BIGINT NOT NULL,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_bid_auction
        FOREIGN KEY (auction_id) REFERENCES auctions(id),
    CONSTRAINT fk_bid_user
        FOREIGN KEY (user_id) REFERENCES users(id)
);
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    auction_id BIGINT NOT NULL,
    buyer_id BIGINT NOT NULL,

    final_price BIGINT NOT NULL,
    status VARCHAR(20) DEFAULT 'PENDING', 
    -- PENDING, PAID, CANCELED

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_order_auction
        FOREIGN KEY (auction_id) REFERENCES auctions(id),
    CONSTRAINT fk_order_buyer
        FOREIGN KEY (buyer_id) REFERENCES users(id)
);
CREATE TABLE payments (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_id BIGINT NOT NULL,

    payment_method VARCHAR(30),
    amount BIGINT NOT NULL,
    status VARCHAR(20) DEFAULT 'READY', 
    -- READY, SUCCESS, FAIL

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_payment_order
        FOREIGN KEY (order_id) REFERENCES orders(id)
);
CREATE TABLE shipments (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_id BIGINT NOT NULL,

    receiver_name VARCHAR(100),
    address VARCHAR(255),
    tracking_number VARCHAR(100),

    status VARCHAR(20) DEFAULT 'READY', 
    -- READY, SHIPPING, DONE

    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_shipment_order
        FOREIGN KEY (order_id) REFERENCES orders(id)
);
CREATE TABLE item_images (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    item_id BIGINT NOT NULL,

    image_url VARCHAR(500) NOT NULL,
    sort_order INT DEFAULT 0,

    CONSTRAINT fk_image_item
        FOREIGN KEY (item_id) REFERENCES items(id)
);




